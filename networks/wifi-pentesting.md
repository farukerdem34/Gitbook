---
description: aircrackng
---

# WiFi Pentesting

For our Wireless Access Points (APs), like our home networks, we all know that there is a password required to access protected networks. Specifically, there are 5 different authentication methods that can be used to ensure that our WiFi stays safe.&#x20;

* WEP
* WPA
* WPA2
* WPA3&#x20;
* WPS (technically, a feature of WiFi)

## Wireless Adapters

To attack Wifi, we would need to make use of something called **packet injection.** When running Linux machines as a a VM, we would not have access to this feature. We would need something called a Wireless Adapter, and specifically one that allows **monitor mode.** Monitor mode would allow us to basically inject packets.&#x20;

Wireless adapters are necessary also to sniff for packets (basically start capturing packets that are transmitted in the air).&#x20;

Personally, I the D-LINK DWA-192, which is this Death Star looking one, but you can use any of them. Here's a link to all the adapters that have monitor mode enabled:

{% embed url="https://kalitut.com/usb-wi-fi-adapters-supporting-monitor/" %}

Afterwards, we can configure the adapter accordingly like so:

```bash
iw dev <interface_name> interface add mon0 type monitor # add new network interface with monitor mode
iwconfig mon0 # check new interface
iw del mon0 interface del # delete new interface
systemctl restart NetworkManager.service # restart network manager
ifconfig <interface_name> down # turn off monitor mode
```

## WEP (Deprecated)

Wired Equivalent Privacy is a security algorithm for wireless networks. This algorithm secures wireless data transmissions and supports end to end encryption and authentication for access points. WEP was created to prevent Man-in-the-middle (MITM) attacks, which it did, for a while.&#x20;

WEP encrypts traffic using a 40, 64 or 128-bit key in hex, which is a **static key**. This means all traffic, regardless of device, is encrypted using a single key. WEP was retired in 2004 and is considered obsolete today, although sometimes it is still used in very, very outdated networks that don't have the hardware to support WPA (which is really rare today).&#x20;

This is how WEP works:

<figure><img src="../.gitbook/assets/image (3) (5) (1).png" alt=""><figcaption></figcaption></figure>

This algorithm uses a key and an Initialisation Vector (IV), which would 24-bits and pseudo-randomly generated. How authentication mechanisms work is illustrated as follows:

<figure><img src="../.gitbook/assets/image (1) (1) (2) (1).png" alt=""><figcaption></figcaption></figure>

The challenge response we send back is the WEP password. After authentication, the pre-shared WEP key would be used to encrypt data frames sent back and forth via RC4 algorithm.&#x20;

WEP is really old and broken, so loads of tools have automated exploits for it, like **airgeddon** and its  all-in-one WEP attacks, which would basically do everything for you. I will just explain some attack methods below.

{% embed url="https://github.com/v1s1t0r1sh3r3/airgeddon" %}

### Passive Attacks

Because the key for WEP is static, and only the IV is randomly generated, it would mean that as packets are generated and encrypted, there is a high probability that there would be **IV Collision**, which means two packets are encrypted using the same key and IV.&#x20;

The passive attack would then revolve around **passively intercepting all wireless traffic** and collecting packets and trying to observe which packets have the same IV used. By XOR-ing those packets together, we can obtain the XOR of the two plaintext messages.&#x20;

In short, we can sit there, collect packets and then break the WiFi Password easily. Once we have the Wifi password, we can gain access to a network, listen for more cleartext packets and so on.&#x20;

### Active Attacks

#### ARP Replay

The ARP replay is when the attacker listens for an ARP packet and retransmits that back to the access point. This would cause the AP to repeat the ARP packet with a new IV. The attacker can then keep collecting these new packets, and afterwards be able to crack it with aircrack-ng or something.

## WPA vs WPA2&#x20;

Wi-Fi Protected Access Versions 1 and 2 are protocols that were created to counter the problems with WEP. WPA was available in 2003, and WPA2 was available in 2004. WPA2, despite being outdated, is still used today.

The difference between the two is that WPA uses something called **Temporal Key Integrity Protocol** (TKIP) to encrypt its traffic. WPA also still incorporates the weak RC4 algorithm, bnut this time uses longer IVs and 256-bit keys. The implemetnation of TKIP would help with generation of new keys. Enterprise mode for WPA basically has stronger authentication via 802.1x and EAP.&#x20;

WPA2 uses AES instead of TKIP to encrypt the traffic, which is a very strong symmetric encryption algorithm relative to TKIP. WPA2 also replaces RC4 with something stronger called CCMP.&#x20;

### Handshake Packet

WPA/WPA2 makes use of a 4-way handshake of the WPA2 protocol. The handshake occurs in this process:

<figure><img src="../.gitbook/assets/image (1) (5) (1).png" alt=""><figcaption></figcaption></figure>

I won't be covering this in detail, but **in essence**, there is a 'handshake' packet that is being transmitted. This packet is being used for the generation and exchanging of data keys. This handshake packet does not contain the password, **but rather simlpy is able to tell us if a password is correct or wrong**. The handshake packet is only transmitted to a client who knows a valid password to the AP.&#x20;

To attack this, we would first need to capture an authentication session with the AP and a known host. There are ways to do like from social engineering, to sending deauth packets to hosts on the network to force a reconnection. Then, we just wait for a handshake packet to be captured and proceed to crack the password through brute forcing.

Here are the commands:

```bash
aireplay-ng -0 0 -a <target> <interface> # send deauth packets, which may work
airodump-ng wlan0 -c 6 --bssid <target> -w ~/capture --output-format pcap # listen for packet
aircrack-ng -w /usr/share/wordlists/rockyou.txt -b <target> ~/capture*.pcap #crack password
```

Simple enough.

### PMKID

Hashcat authors actually released an attack in 2018, which was very interesting because it **relies on one single packet**. No need to listen for handshake packets or whatever.

{% embed url="https://hashcat.net/forum/thread-7717.html" %}

Really good read.

## WPA3

WPA3 was released in 2018 and is the current 'gold' standard for wireless APs. It is the newest form of security and is made to replace WPA2, which is almost 15 years old. WPA3 uses something called **Simultaneous Authentication of Equals (SAE)** to prevent password guessing.&#x20;

The reason SAE is so secure is because it provides a **unique master key** that is different for each client, derived from the passwords. Each client has a different key, meaning that even if I were to capture the handshake packet, it would always be different.&#x20;

SAE is a variant of the Dragonfly key exchagne protocol specified in RFC 7664, which is based on Diffie-Hellman key exchanges. The key management for WPA3 is based on the ECDH and ECDSA, while WPA/WPA2 rely on the 4-way handshake. The reason it's so secure is that, it takes the 4-way handshake mechanism from WPA2 and adds cryptographic procedures to that, making it even harder for attackers to exploit.

Currently, the exploits for WPA3 are quite difficult to pull off, and mainly involve downgrading and DoS attacks. I found this resource a good read for WPA3 related exploits, such as CVE-2019-9494.

{% embed url="https://wpa3.mathyvanhoef.com/" %}

If you want to learn more about the Dragonfly handshake mechanism, here's another good paper to read:

{% embed url="https://eprint.iacr.org/2019/383" %}

## WPS

Wifi Protected Setup, otherwise known as WPS, is a wireless security standard that is made to allow for connections to a WPA/WPA2 AP faster and easier.

Typically, it's a button on the back of routers. Looks something like this:

<figure><img src="../.gitbook/assets/image (8) (1) (2).png" alt=""><figcaption></figcaption></figure>

Normally, I use this in conjunction with a printer at home. When we press this thing and configure the printer to start connecting via WPS, the printer would connect automatically to our network without the need to enter our password.

What happens when we press the WPS button on a router is that the router enters WPS mode, which allow for other devices on WPS mode to connect to it for a period of about 1-2 minutes. If the router does not rely on a physical button, then it uses an 8-digit PIN.

This 8-Digit PIN can be brute forced super easily and give us access to a network. To get a router into WPS mode, we either need to force a client to disconnect via Deauth packets (which may not work) or we would need access to the router directly (which is probably not happening). Once the 8-digit PIN is brute forced, we can also find out the actual password for the network.&#x20;

We can brute force the PIN using reaver, which would return the PIN and password:

```bash
reaver --bssid <target MAC> --channel <channel> --interface <interface> -vvv -no-associate
```
